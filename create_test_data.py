# (‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà: create_test_data.py)

import hr_database  # (‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏¢‡∏∑‡∏° '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á' ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏°‡∏≤‡πÉ‡∏ä‡πâ)
from datetime import datetime, timedelta

# --- ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏¢‡∏¥‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ ---

# (‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÅ‡∏Å‡∏•‡πâ‡∏á‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ 6 ‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô 2025)
# (‡∏ñ‡πâ‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö today ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå-‡∏®‡∏∏‡∏Å‡∏£‡πå)
today = datetime(2025, 11, 6) # (‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ)

# --- 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏≥‡∏•‡∏≠‡∏á ---
# (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô dict ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏¢‡∏¥‡∏á‡∏ú‡πà‡∏≤‡∏ô _upsert_employee_data)
# (‡πÄ‡∏£‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà '‡∏™‡∏°‡∏≠‡∏á' ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ)

employee_data = {
    "EMP_OFFICE": {
        "id": "EMP_OFFICE",
        "fname": "‡πÄ‡∏ó‡∏™",
        "lname": "‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏®",
        "status": "‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà",
        "work_location": "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà" # (‡∏Å‡∏é 8:30)
    },
    "EMP_WAREHOUSE": {
        "id": "EMP_WAREHOUSE",
        "fname": "‡πÄ‡∏ó‡∏™",
        "lname": "‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤",
        "status": "‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà",
        "work_location": "‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" # (‡∏Å‡∏é 8:00)
    },
}

# --- 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Log ‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡∏≥‡∏•‡∏≠‡∏á ---
# (List of tuples: (emp_id, scan_timestamp))

scan_log_data = [
    # --- ‡∏ô‡∏≤‡∏¢‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏® (‡∏Å‡∏é 8:30) ---
    # ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (6 ‡∏û.‡∏¢.): ‡∏°‡∏≤ 8:40:00 (‡∏™‡∏≤‡∏¢ 10 ‡∏ô‡∏≤‡∏ó‡∏µ)
    ("EMP_OFFICE", datetime(today.year, today.month, today.day, 8, 40, 0)),
    # ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (6 ‡∏û.‡∏¢.): ‡∏™‡πÅ‡∏Å‡∏ô‡∏≠‡∏≠‡∏Å (‡πÑ‡∏°‡πà‡∏™‡∏ô‡πÉ‡∏à)
    ("EMP_OFFICE", datetime(today.year, today.month, today.day, 17, 30, 0)),
    
    # --- ‡∏ô‡∏≤‡∏¢‡∏Ñ‡∏•‡∏±‡∏á (‡∏Å‡∏é 8:00) ---
    # ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (6 ‡∏û.‡∏¢.): ‡∏°‡∏≤ 8:05:00 (‡∏™‡∏≤‡∏¢ 5 ‡∏ô‡∏≤‡∏ó‡∏µ)
    ("EMP_WAREHOUSE", datetime(today.year, today.month, today.day, 8, 5, 0)),
    # ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (6 ‡∏û.‡∏¢.): ‡∏™‡πÅ‡∏Å‡∏ô‡∏≠‡∏≠‡∏Å
    ("EMP_WAREHOUSE", datetime(today.year, today.month, today.day, 17, 0, 0)),

    # (‡∏•‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏ô‡πÑ‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô (5 ‡∏û.‡∏¢.))
    # ‡∏ô‡∏≤‡∏¢‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏®: ‡∏°‡∏≤ 8:29:00 (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏¢)
    ("EMP_OFFICE", datetime(today.year, today.month, today.day-1, 8, 29, 0)),
    # ‡∏ô‡∏≤‡∏¢‡∏Ñ‡∏•‡∏±‡∏á: ‡∏°‡∏≤ 7:59:00 (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏¢)
    ("EMP_WAREHOUSE", datetime(today.year, today.month, today.day-1, 7, 59, 0)),
    
    # (‡∏•‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏ô‡πÑ‡∏õ 2 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô (4 ‡∏û.‡∏¢.))
    # ‡∏ô‡∏≤‡∏¢‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏®: ‡πÑ‡∏°‡πà‡∏°‡∏≤ (‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô)
    # ‡∏ô‡∏≤‡∏¢‡∏Ñ‡∏•‡∏±‡∏á: ‡∏°‡∏≤ 8:15:00 (‡∏™‡∏≤‡∏¢ 15 ‡∏ô‡∏≤‡∏ó‡∏µ)
    ("EMP_WAREHOUSE", datetime(today.year, today.month, today.day-2, 8, 15, 0)),
]


# --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡∏¢‡∏¥‡∏á" ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
def setup_test_environment():
    print("--- üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö ---")
    
    conn = hr_database.get_db_connection()
    if not conn:
        print("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß")
        return

    try:
        with conn.cursor() as cursor:
            
            # --- ‡∏¢‡∏¥‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ---
            print("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏≥‡∏•‡∏≠‡∏á 2 ‡∏Ñ‡∏ô (EMP_OFFICE, EMP_WAREHOUSE)...")
            for emp_data in employee_data.values():
                # (‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô _upsert_employee_data ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)
                # (ON CONFLICT DO UPDATE ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á)
                hr_database._upsert_employee_data(cursor, emp_data)
            print("‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!")

            # --- ‡∏¢‡∏¥‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Log Scan ---
            print(f"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏¥‡∏á Log ‡∏™‡πÅ‡∏Å‡∏ô {len(scan_log_data)} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...")
            # (‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô insert_scan_logs ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ)
            # (ON CONFLICT DO NOTHING ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á)
            success_count = hr_database.insert_scan_logs(scan_log_data)
            print(f"‚úÖ ‡∏¢‡∏¥‡∏á Log ‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà {success_count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)")

            conn.commit() # (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)

    except Exception as e:
        conn.rollback()
        print(f"‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á: {e}")
    finally:
        if conn: conn.close()
        print("--- üèÅ ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö ---")

# --- ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ ---
if __name__ == "__main__":
    setup_test_environment()