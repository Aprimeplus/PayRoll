import pandas as pd
from datetime import datetime

# --- (ข้อสังเกต) ---
# เราจะใช้ปี ค.ศ. (2024) ในไฟล์ Excel
# เนื่องจากโค้ดของคุณในส่วน "ขั้นตอนที่ 2" (DateEntry) 
# จะแปลงค่า พ.ศ. 2567 กลับมาเป็น datetime(2024, ...) (ปี ค.ศ.)
# การใช้ปี ค.ศ. ในไฟล์ข้อมูลดิบ จะทำให้การค้นหาในฐานข้อมูล (Step 2) ทำงานถูกต้องครับ
# (อ่านคำอธิบายเพิ่มเติมด้านล่าง)

print("กำลังสร้างไฟล์ Excel สำหรับทดสอบ...")

# 1. กำหนดโครงสร้างข้อมูล
# เราจะใช้ชื่อคอลัมน์ที่ระบบของคุณรองรับ
columns = ["รหัสพนักงาน", "วันที่", "เวลาเข้างาน", "เวลาออกงาน"]

data = [
    # --- พนักงาน 101 (มาปกติ) ---
    {"รหัสพนักงาน": "101", "วันที่": "01/11/2024", "เวลาเข้างาน": "07:55", "เวลาออกงาน": "17:01"},
    {"รหัสพนักงาน": "101", "วันที่": "02/11/2024", "เวลาเข้างาน": "08:00", "เวลาออกงาน": "17:00"},
    # (วันที่ 3/11/2024 ใช้รูปแบบวันที่ไม่มี 0 นำหน้า เพื่อทดสอบ)
    {"รหัสพนักงาน": "101", "วันที่": "3/11/2024", "เวลาเข้างาน": "07:59", "เวลาออกงาน": "17:05"},

    # --- พนักงาน 102 (มาสาย + ขาดงาน) ---
    # (วันที่ 1 มาสาย)
    {"รหัสพนักงาน": "102", "วันที่": "01/11/2024", "เวลาเข้างาน": "08:35", "เวลาออกงาน": "17:30"}, 
    # (วันที่ 2 ขาดงาน - ไม่มี Log เข้า/ออก)
    {"รหัสพนักงาน": "102", "วันที่": "02/11/2024", "เวลาเข้างาน": "nan", "เวลาออกงาน": "nan"}, 
    # (วันที่ 3 มาสายอีก)
    {"รหัสพนักงาน": "102", "วันที่": "03/11/2024", "เวลาเข้างาน": "09:01", "เวลาออกงาน": "17:00"},
    
    # --- พนักงาน 103 (ทดสอบรูปแบบเวลาที่ต่างกัน) ---
    # (วันที่ 1 มาสาย และใช้ . แทน :)
    {"รหัสพนักงาน": "103", "วันที่": "01/11/2024", "เวลาเข้างาน": "08.15", "เวลาออกงาน": "17.00"}, 
    # (วันที่ 2 สแกนเข้า แต่ไม่สแกนออก)
    {"รหัสพนักงาน": "103", "วันที่": "02/11/2024", "เวลาเข้างาน": "07:58", "เวลาออกงาน": ""},
    # (วันที่ 3 ไม่สแกนเข้า แต่สแกนออก)
    {"รหัสพนักงาน": "103", "วันที่": "03/11/2024", "เวลาเข้างาน": None, "เวลาออกงาน": "17:01"},

    # --- พนักงาน 104 (ทดสอบค่าที่ควรกระโดดข้าม) ---
    # (ทดสอบค่า '0' ที่คุณดักไว้ใน BAD_TIME_VALUES)
    {"รหัสพนักงาน": "104", "วันที่": "01/11/2024", "เวลาเข้างาน": "0", "เวลาออกงาน": "0"},
    # (ข้อมูลถูกต้องในวันถัดไป)
    {"รหัสพนักงาน": "104", "วันที่": "02/11/2024", "เวลาเข้างาน": "07:50", "เวลาออกงาน": "17:02"},
]

# 2. สร้าง DataFrame
df = pd.DataFrame(data, columns=columns)

# 3. บันทึกเป็นไฟล์ Excel
file_name = "test_log_data.xlsx"
try:
    df.to_excel(file_name, index=False, engine='openpyxl')
    
    # ดึง path ปัจจุบันเพื่อความชัดเจน
    import os
    full_path = os.path.abspath(file_name)
    print(f"\n✅ สร้างไฟล์ '{file_name}' เรียบร้อยแล้ว!")
    print(f"   (ที่อยู่ไฟล์: {full_path})")
    print("\nคุณสามารถใช้ไฟล์นี้ใน 'ขั้นตอนที่ 1' ของโปรแกรมได้เลยครับ")

except Exception as e:
    print(f"\n❌ เกิดข้อผิดพลาดในการสร้างไฟล์ Excel: {e}")
    print("กรุณาตรวจสอบว่าคุณได้ติดตั้ง 'pandas' และ 'openpyxl' แล้ว")
    print("($ pip install pandas openpyxl)")