# (‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà: setup_test_employees.py)
# (‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ "‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Database)

import hr_database
from psycopg2 import extras
import tkinter as tk
from tkinter import messagebox

# --- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö ---
employee_data = [
    {
        "id": "TEST-001",
        "fname": "‡πÄ‡∏ó‡∏™",
        "lname": "‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏®",
        "status": "‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà",
        "work_location": "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà" # (‡∏Å‡∏é 8:30)
    },
    {
        "id": "TEST-002",
        "fname": "‡πÄ‡∏ó‡∏™",
        "lname": "‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤",
        "status": "‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà",
        "work_location": "‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" # (‡∏Å‡∏é 8:00)
    },
]

def setup_test_employees():
    print("--- üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏° '‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå' ‡πÅ‡∏•‡∏∞ '‡∏™‡∏£‡πâ‡∏≤‡∏á' ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö ---")
    
    # (‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á tkinter)
    root = tk.Tk()
    root.withdraw() 
    
    conn = hr_database.get_db_connection()
    if not conn:
        print("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß")
        return

    try:
        with conn.cursor() as cursor:
            
            # --- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ---
            print("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö 2 ‡∏Ñ‡∏ô (TEST-001, TEST-002)...")
            for emp_data in employee_data:
                # (‡πÉ‡∏ä‡πâ ON CONFLICT... ‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á)
                hr_database._upsert_employee_data(cursor, emp_data)
            print("‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!")

            # --- ‡∏•‡πâ‡∏≤‡∏á Log ‡πÄ‡∏Å‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ---
            print("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡πâ‡∏≤‡∏á Log ‡∏î‡∏¥‡∏ö‡πÄ‡∏Å‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)...")
            cursor.execute("""
                DELETE FROM time_attendance_logs 
                WHERE emp_id LIKE 'TEST-%' OR emp_id LIKE 'EMP_%'
            """)
            print(f"‚úÖ ‡∏•‡πâ‡∏≤‡∏á Log ‡∏î‡∏¥‡∏ö‡πÄ‡∏Å‡πà‡∏≤ {cursor.rowcount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!")

            conn.commit()
            messagebox.showinfo("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", 
                                "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!\n\n"
                                "1. ‡∏™‡∏£‡πâ‡∏≤‡∏á TEST-001 (‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏®) ‡πÅ‡∏•‡∏∞ TEST-002 (‡∏Ñ‡∏•‡∏±‡∏á)\n"
                                "2. ‡∏•‡πâ‡∏≤‡∏á Log ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Å‡πà‡∏≤‡πÜ ‡∏ó‡∏¥‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß")

    except Exception as e:
        conn.rollback()
        messagebox.showerror("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", f"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ:\n{e}")
    finally:
        if conn: conn.close()
        root.destroy()
        print("--- üèÅ ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---")

# --- ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ ---
if __name__ == "__main__":
    setup_test_employees()